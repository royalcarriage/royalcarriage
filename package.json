{
  "name": "rest-express",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "license": "MIT",
  "workspaces": [
    "apps/*",
    "packages/*"
  ],
  "scripts": {
    "dev": "npm run dev:admin",
    "dev:marketing": "astro dev",
    "dev:admin": "npm --prefix apps/admin run dev",
    "dev:api": "NODE_ENV=development tsx server/index.ts",
    "build": "npm run build:all",
    "build:marketing": "astro build",
    "build:api": "tsx script/build.ts",
    "preview": "astro preview",
    "astro": "astro",
    "prepare": "husky install",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "lint": "eslint \"**/*.{js,ts,tsx}\" --ignore-pattern \"**/node_modules/**\" --ignore-pattern \"**/.venv/**\" --ignore-pattern \"**/site-packages/**\" --ignore-pattern \"**/dist/**\" --ignore-pattern \"**/.next/**\" --ignore-pattern \"**/_next/**\" --ignore-pattern \"**/out/**\" --ignore-pattern \"**/.astro/**\"",
    "lint:fix": "eslint \"**/*.{js,ts,tsx}\" --ignore-pattern \"**/node_modules/**\" --ignore-pattern \"**/.venv/**\" --ignore-pattern \"**/site-packages/**\" --ignore-pattern \"**/dist/**\" --ignore-pattern \"**/.next/**\" --ignore-pattern \"**/_next/**\" --ignore-pattern \"**/out/**\" --ignore-pattern \"**/.astro/**\" --fix",
    "check:html": "echo 'HTML validation skipped - Astro generates valid HTML'",
    "check:css": "stylelint \"apps/**/*.{css,scss,astro}\" --allow-empty-input || echo 'Stylelint not installed - CSS validation skipped'",
    "check:links": "linkinator apps/airport/dist/index.html --recurse --silent --skip \"^(mailto:|tel:|data:|javascript:)\" && linkinator apps/corporate/dist/index.html --recurse --silent --skip \"^(mailto:|tel:|data:|javascript:)\" && linkinator apps/wedding/dist/index.html --recurse --silent --skip \"^(mailto:|tel:|data:|javascript:)\" && linkinator apps/partybus/dist/index.html --recurse --silent --skip \"^(mailto:|tel:|data:|javascript:)\"",
    "build:airport": "npm -w @royal/airport run build",
    "build:corporate": "npm -w @royal/corporate run build",
    "build:wedding": "npm -w @royal/wedding run build",
    "build:partybus": "npm -w @royal/partybus run build",
    "build:all": "node ./scripts/build-all.mjs",
    "deploy:airport": "firebase deploy --only hosting:airport",
    "deploy:corporate": "firebase deploy --only hosting:corporate",
    "deploy:wedding": "firebase deploy --only hosting:wedding",
    "deploy:partybus": "firebase deploy --only hosting:partybus",
    "deploy:all": "firebase deploy --only hosting:airport,hosting:corporate,hosting:wedding,hosting:partybus",
    "deploy:microsites": "npm run deploy:all",
    "verify:seo": "node ./scripts/verify-seo.mjs",
    "verify:links": "node ./scripts/verify-links.mjs",
    "verify:admin": "node ./scripts/verify-admin-links.mjs",
    "verify:db": "node ./scripts/verify-db.mjs",
    "verify:phase3:sources": "node ./scripts/verify-phase3-sources.mjs",
    "open:week1:searches": "node ./scripts/open-week1-searches.mjs",
    "download:phase3:images": "node ./scripts/download-phase3-images.mjs",
    "download:phase3:missing": "node ./scripts/download-missing-phase3.mjs",
    "download:phase3:direct": "node ./scripts/download-direct-phase3.mjs",
    "test": "node --test tests/unit/*.test.mjs",
    "test:rules": "firebase emulators:exec --config firebase.test.json --only firestore,storage \"bash -lc 'node --test tests/rules/*.test.mjs'\"",
    "verify:all": "npm run verify:links && npm run verify:db && npm run verify:seo && npm run verify:admin",
    "audit:workspace": "node ./scripts/audit-workspace.mjs",
    "audit:firebase:mfa": "node ./scripts/audit-firebase-mfa.mjs",
    "audit:system": "node ./scripts/audit-system.mjs",
    "audit:schedule": "node ./scripts/audit-scheduler.mjs",
    "health:monitor": "node ./scripts/health-monitor.mjs",
    "health:check": "node ./scripts/health-monitor.mjs --check-firebase",
    "migrate:adminUsers:dry": "node ./functions/migrate-admin-users.mjs",
    "migrate:adminUsers:apply": "node ./functions/migrate-admin-users.mjs --apply",
    "audit:images:content": "node - <<'NODE'\nimport fs from 'fs';\nimport path from 'path';\n\nconst repo = process.cwd();\nconst contentDir = path.join(repo, 'packages/content/sites');\nconst appBySlug = {\n  airport: 'apps/airport',\n  corporate: 'apps/corporate',\n  wedding: 'apps/wedding',\n  partybus: 'apps/partybus',\n};\n\nfunction walk(obj, visit) {\n  if (Array.isArray(obj)) {\n    for (const item of obj) walk(item, visit);\n    return;\n  }\n  if (obj && typeof obj === 'object') {\n    for (const [k, v] of Object.entries(obj)) {\n      visit(k, v);\n      walk(v, visit);\n    }\n  }\n}\n\nlet totalMissing = 0;\nfor (const file of fs.readdirSync(contentDir)) {\n  if (!file.endsWith('.json')) continue;\n  const full = path.join(contentDir, file);\n  const raw = fs.readFileSync(full, 'utf8');\n  const data = JSON.parse(raw);\n  const slug = data.targetSlug;\n  const appRel = appBySlug[slug];\n  if (!appRel) continue;\n  const publicDir = path.join(repo, appRel, 'public');\n\n  const referenced = new Set();\n  walk(data, (_k, v) => {\n    if (typeof v === 'string' && v.startsWith('/images/')) referenced.add(v);\n  });\n\n  const missing = [];\n  for (const img of referenced) {\n    const disk = path.join(publicDir, img);\n    if (!fs.existsSync(disk)) missing.push(img);\n  }\n\n  if (missing.length) {\n    totalMissing += missing.length;\n    console.log(`\\n[${slug}] ${missing.length} missing of ${referenced.size} referenced (public: ${appRel}/public)`);\n    for (const m of missing) console.log(`  - ${m}`);\n  } else {\n    console.log(`[${slug}] OK (${referenced.size} referenced)`);\n  }\n}\n\nif (totalMissing) {\n  console.log(`\\nTOTAL missing images: ${totalMissing}`);\n  process.exit(2);\n} else {\n  console.log('\\nAll referenced images exist.');\n}\nNODE",
    "audit:images:relevance": "node ./scripts/audit-image-relevance.mjs",
    "audit:images:dist": "node - <<'NODE'\nimport fs from 'fs';\nimport path from 'path';\n\nconst repo = process.cwd();\nconst sites = [\n  { slug: 'airport', dist: 'apps/airport/dist', publicDir: 'apps/airport/public' },\n  { slug: 'corporate', dist: 'apps/corporate/dist', publicDir: 'apps/corporate/public' },\n  { slug: 'wedding', dist: 'apps/wedding/dist', publicDir: 'apps/wedding/public' },\n  { slug: 'partybus', dist: 'apps/partybus/dist', publicDir: 'apps/partybus/public' },\n];\n\nfunction* walkFiles(dir) {\n  for (const ent of fs.readdirSync(dir, { withFileTypes: true })) {\n    const full = path.join(dir, ent.name);\n    if (ent.isDirectory()) yield* walkFiles(full);\n    else yield full;\n  }\n}\n\nconst IMG_RE = /<img\\b[^>]*?\\ssrc=(\"|')([^\"']+)(\\1)[^>]*>/gi;\n\nlet totalMissing = 0;\nfor (const s of sites) {\n  const distDir = path.join(repo, s.dist);\n  const pubDir = path.join(repo, s.publicDir);\n  const missing = new Map();\n\n  for (const file of walkFiles(distDir)) {\n    if (!file.endsWith('.html')) continue;\n    const html = fs.readFileSync(file, 'utf8');\n    let m;\n    while ((m = IMG_RE.exec(html))) {\n      const src = m[2];\n      if (src.startsWith('data:')) continue;\n      if (src.startsWith('http://') || src.startsWith('https://')) continue;\n      if (src.startsWith('//')) continue;\n\n      const normalized = src.startsWith('/') ? src : '/' + src;\n      const disk = path.join(pubDir, normalized);\n      if (!fs.existsSync(disk)) {\n        const relHtml = path.relative(distDir, file);\n        if (!missing.has(normalized)) missing.set(normalized, new Set());\n        missing.get(normalized).add(relHtml);\n      }\n    }\n  }\n\n  if (missing.size) {\n    totalMissing += missing.size;\n    console.log(`\\n[${s.slug}] Missing img assets referenced by built HTML: ${missing.size}`);\n    for (const [src, files] of missing.entries()) {\n      const sample = Array.from(files).slice(0, 3).join(', ');\n      console.log(`  - ${src} (e.g. ${sample})`);\n    }\n  } else {\n    console.log(`[${s.slug}] OK (no missing <img src> assets found)`);\n  }\n}\n\nif (totalMissing) {\n  process.exit(2);\n} else {\n  console.log('\\nAll <img src> assets referenced by built HTML exist in public/.');\n}\nNODE",
    "yolo": "node ./scripts/yolo-agent.mjs",
    "audit:lighthouse": "npx lighthouse http://localhost:4321 --only-categories=performance,accessibility,best-practices,seo --view --quiet || echo 'Lighthouse audit requires local dev server running'",
    "audit:all": "npm run lint && npm run format:check && npm run check:html && npm run check:css",
    "ci": "npm ci && npm run audit:all",
    "quality": "npm run audit:all",
    "deploy:check": "npm run build && npm run quality",
    "test:e2e": "playwright test",
    "sync:images": "node ./scripts/images-sync.mjs all",
    "images:download": "node ./scripts/auto-download-images.mjs",
    "images:convert": "node ./scripts/batch-convert-webp.mjs",
    "images:validate": "node ./scripts/image-quality-optimizer.mjs --site all --analyze --report",
    "images:upload": "node ./scripts/upload-to-firebase.mjs --site all",
    "images:sync": "npm run sync:images",
    "images:quality-gate": "npm run build:all",
    "images:deploy": "npm run deploy:all",
    "images:pipeline": "node ./scripts/execute-full-pipeline.mjs",
    "images:pipeline-quick": "npm run images:convert && npm run images:validate && npm run images:sync && npm run deploy:all",
    "admin:dashboard-setup": "node ./scripts/setup-admin-dashboard.mjs",
    "seo:images": "npm run admin:dashboard-setup && npm run images:pipeline",
    "metrics:import": "node ./scripts/metrics-import.mjs",
    "sitemap:generate": "node ./scripts/generate-sitemap.mjs",
    "start": "NODE_ENV=production node dist/index.cjs",
    "check": "tsc"
  },
  "dependencies": {
    "@google-cloud/aiplatform": "^6.1.0",
    "@google-cloud/storage": "^7.16.0",
    "@google-cloud/vertexai": "^1.10.0",
    "@hookform/resolvers": "^3.10.0",
    "@jridgewell/trace-mapping": "^0.3.25",
    "@octokit/rest": "^22.0.0",
    "@radix-ui/react-accordion": "^1.2.4",
    "@radix-ui/react-alert-dialog": "^1.1.7",
    "@radix-ui/react-aspect-ratio": "^1.1.3",
    "@radix-ui/react-avatar": "^1.1.4",
    "@radix-ui/react-checkbox": "^1.1.5",
    "@radix-ui/react-collapsible": "^1.1.4",
    "@radix-ui/react-context-menu": "^2.2.7",
    "@radix-ui/react-dialog": "^1.1.7",
    "@radix-ui/react-dropdown-menu": "^2.1.7",
    "@radix-ui/react-hover-card": "^1.1.7",
    "@radix-ui/react-label": "^2.1.3",
    "@radix-ui/react-menubar": "^1.1.7",
    "@radix-ui/react-navigation-menu": "^1.2.6",
    "@radix-ui/react-popover": "^1.1.7",
    "@radix-ui/react-progress": "^1.1.3",
    "@radix-ui/react-radio-group": "^1.2.4",
    "@radix-ui/react-scroll-area": "^1.2.4",
    "@radix-ui/react-select": "^2.1.7",
    "@radix-ui/react-separator": "^1.1.3",
    "@radix-ui/react-slider": "^1.2.4",
    "@radix-ui/react-slot": "^1.2.0",
    "@radix-ui/react-switch": "^1.1.4",
    "@radix-ui/react-tabs": "^1.1.4",
    "@radix-ui/react-toast": "^1.2.7",
    "@radix-ui/react-toggle": "^1.1.3",
    "@radix-ui/react-toggle-group": "^1.1.3",
    "@radix-ui/react-tooltip": "^1.2.0",
    "@tanstack/react-query": "^5.60.5",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "connect-pg-simple": "^10.0.0",
    "date-fns": "^3.6.0",
    "drizzle-orm": "^0.39.3",
    "drizzle-zod": "^0.7.0",
    "embla-carousel-react": "^8.6.0",
    "express": "^4.21.2",
    "express-session": "^1.18.1",
    "firebase": "^12.7.0",
    "firebase-admin": "^13.6.0",
    "firebase-functions": "^7.0.3",
    "framer-motion": "^11.13.1",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.453.0",
    "memorystore": "^1.6.7",
    "next-themes": "^0.4.6",
    "openai": "^6.16.0",
    "passport": "^0.7.0",
    "passport-local": "^1.0.0",
    "pg": "^8.16.3",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-helmet-async": "^2.0.5",
    "react-hook-form": "^7.55.0",
    "react-icons": "^5.4.0",
    "react-resizable-panels": "^2.1.7",
    "recharts": "^2.15.2",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "tw-animate-css": "^1.2.5",
    "vaul": "^1.1.2",
    "wouter": "^3.3.5",
    "uuid": "^9.0.0",
    "ws": "^8.18.0",
    "zod": "^3.24.2",
    "zod-validation-error": "^3.4.0"
  },
  "devDependencies": {
    "@astrojs/sitemap": "^3.6.1",
    "@astrojs/tailwind": "^6.0.2",
    "@eslint/js": "^9.39.2",
    "@firebase/rules-unit-testing": "^3.0.0",
    "@playwright/test": "^1.57.0",
    "@replit/vite-plugin-cartographer": "^0.4.4",
    "@replit/vite-plugin-dev-banner": "^0.1.1",
    "@replit/vite-plugin-runtime-error-modal": "^0.0.3",
    "@tailwindcss/typography": "^0.5.15",
    "@tailwindcss/vite": "^4.1.18",
    "@types/connect-pg-simple": "^7.0.3",
    "@types/express": "4.17.21",
    "@types/express-session": "^1.18.0",
    "@types/ms": "^0.7.34",
    "@types/node": "20.19.27",
    "@types/passport": "^1.0.16",
    "@types/passport-local": "^1.0.38",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/ws": "^8.5.13",
    "@typescript-eslint/eslint-plugin": "^8.0.0",
    "@typescript-eslint/parser": "^8.0.0",
    "@vitejs/plugin-react": "^4.7.0",
    "@vitest/coverage-v8": "^4.0.17",
    "autoprefixer": "^10.4.20",
    "drizzle-kit": "^0.31.8",
    "esbuild": "^0.25.0",
    "eslint": "^8.43.0",
    "eslint-config-prettier": "^10.1.8",
    "eslint-plugin-astro": "^1.5.0",
    "eslint-plugin-prettier": "^5.1.0",
    "firebase-tools": "^13.16.0",
    "globals": "^15.0.0",
    "husky": "^8.0.0",
    "linkinator": "^6.1.0",
    "lint-staged": "^16.2.7",
    "postcss": "^8.4.47",
    "prettier": "^3.0.0",
    "sharp": "^0.34.5",
    "stylelint": "^15.11.0",
    "stylelint-config-standard": "^34.0.0",
    "tailwindcss": "^3.4.19",
    "tsx": "^4.20.5",
    "typescript": "5.6.3",
    "vite": "^7.3.0",
    "vitest": "^4.0.17"
  },
  "overrides": {
    "drizzle-kit": {
      "@esbuild-kit/esm-loader": "npm:tsx@^4.20.4"
    }
  },
  "optionalDependencies": {
    "bufferutil": "4.1.0"
  }
}
